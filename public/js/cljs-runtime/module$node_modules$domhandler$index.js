shadow$provide.module$node_modules$domhandler$index=function(global,process,require,module,exports,shadow$shims){function DomHandler(callback,options,elementCB){"object"===typeof callback?(elementCB=options,options=callback,callback=null):"function"===typeof options&&(elementCB=options,options=defaultOpts);this._callback=callback;this._options=options||defaultOpts;this._elementCB=elementCB;this.dom=[];this._done=!1;this._tagStack=[];this._parser=this._parser||null}var ElementType=require("module$node_modules$domelementtype$index"),
re_whitespace=/\s+/g,NodePrototype=require("module$node_modules$domhandler$lib$node"),ElementPrototype=require("module$node_modules$domhandler$lib$element"),defaultOpts={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1};DomHandler.prototype.onparserinit=function(parser){this._parser=parser};DomHandler.prototype.onreset=function(){DomHandler.call(this,this._callback,this._options,this._elementCB)};DomHandler.prototype.onend=function(){this._done||(this._done=!0,this._parser=null,this._handleCallback(null))};
DomHandler.prototype._handleCallback=DomHandler.prototype.onerror=function(error){if("function"===typeof this._callback)this._callback(error,this.dom);else if(error)throw error;};DomHandler.prototype.onclosetag=function(){var elem=this._tagStack.pop();this._options.withEndIndices&&elem&&(elem.endIndex=this._parser.endIndex);this._elementCB&&this._elementCB(elem)};DomHandler.prototype._createDomElement=function(properties){if(!this._options.withDomLvl1)return properties;var element="tag"===properties.type?
Object.create(ElementPrototype):Object.create(NodePrototype);for(var key in properties)properties.hasOwnProperty(key)&&(element[key]=properties[key]);return element};DomHandler.prototype._addDomElement=function(element){var parent=this._tagStack[this._tagStack.length-1],siblings=parent?parent.children:this.dom,previousSibling=siblings[siblings.length-1];element.next=null;this._options.withStartIndices&&(element.startIndex=this._parser.startIndex);this._options.withEndIndices&&(element.endIndex=this._parser.endIndex);
previousSibling?(element.prev=previousSibling,previousSibling.next=element):element.prev=null;siblings.push(element);element.parent=parent||null};DomHandler.prototype.onopentag=function(name,attribs){name=this._createDomElement({type:"script"===name?ElementType.Script:"style"===name?ElementType.Style:ElementType.Tag,name:name,attribs:attribs,children:[]});this._addDomElement(name);this._tagStack.push(name)};DomHandler.prototype.ontext=function(data){var normalize=this._options.normalizeWhitespace||
this._options.ignoreWhitespace,lastTag;!this._tagStack.length&&this.dom.length&&(lastTag=this.dom[this.dom.length-1]).type===ElementType.Text?lastTag.data=normalize?(lastTag.data+data).replace(re_whitespace," "):lastTag.data+data:this._tagStack.length&&(lastTag=this._tagStack[this._tagStack.length-1])&&(lastTag=lastTag.children[lastTag.children.length-1])&&lastTag.type===ElementType.Text?lastTag.data=normalize?(lastTag.data+data).replace(re_whitespace," "):lastTag.data+data:(normalize&&(data=data.replace(re_whitespace,
" ")),data=this._createDomElement({data:data,type:ElementType.Text}),this._addDomElement(data))};DomHandler.prototype.oncomment=function(data){var lastTag=this._tagStack[this._tagStack.length-1];lastTag&&lastTag.type===ElementType.Comment?lastTag.data+=data:(data=this._createDomElement({data:data,type:ElementType.Comment}),this._addDomElement(data),this._tagStack.push(data))};DomHandler.prototype.oncdatastart=function(){var element=this._createDomElement({children:[{data:"",type:ElementType.Text}],
type:ElementType.CDATA});this._addDomElement(element);this._tagStack.push(element)};DomHandler.prototype.oncommentend=DomHandler.prototype.oncdataend=function(){this._tagStack.pop()};DomHandler.prototype.onprocessinginstruction=function(name,data){name=this._createDomElement({name:name,data:data,type:ElementType.Directive});this._addDomElement(name)};module.exports=DomHandler}
//# sourceMappingURL=module$node_modules$domhandler$index.js.map
