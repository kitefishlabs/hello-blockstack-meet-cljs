shadow$provide.module$node_modules$triplesec$lib$scrypt=function(global,process,require,module,exports,shadow$shims){(function(){var iced=require("module$node_modules$iced_runtime$lib$main");var HMAC_SHA256=require("module$node_modules$triplesec$lib$hmac").HMAC_SHA256;var pbkdf2=require("module$node_modules$triplesec$lib$pbkdf2").pbkdf2;var _ref=require("module$node_modules$triplesec$lib$salsa20");var endian_reverse=_ref.endian_reverse;var Salsa20InnerCore=_ref.Salsa20InnerCore;var WordArray=require("module$node_modules$triplesec$lib$wordarray").WordArray;
_ref=require("module$node_modules$triplesec$lib$util");var fixup_uint32=_ref.fixup_uint32;var default_delay=_ref.default_delay;var scrub_vec=_ref.scrub_vec;new (function(){function Timer(){this.tot=0}Timer.prototype.start=function(){return this._t=Date.now()};Timer.prototype.stop=function(){return this.tot+=Date.now()-this._t};return Timer}());var blkcpy=function(D,S,d_offset,s_offset,len){d_offset=d_offset<<4|0;s_offset=s_offset<<4|0;for(len=s_offset+(len<<4)|0;s_offset<len;)D[d_offset]=S[s_offset],
D[d_offset+1]=S[s_offset+1],D[d_offset+2]=S[s_offset+2],D[d_offset+3]=S[s_offset+3],D[d_offset+4]=S[s_offset+4],D[d_offset+5]=S[s_offset+5],D[d_offset+6]=S[s_offset+6],D[d_offset+7]=S[s_offset+7],D[d_offset+8]=S[s_offset+8],D[d_offset+9]=S[s_offset+9],D[d_offset+10]=S[s_offset+10],D[d_offset+11]=S[s_offset+11],D[d_offset+12]=S[s_offset+12],D[d_offset+13]=S[s_offset+13],D[d_offset+14]=S[s_offset+14],D[d_offset+15]=S[s_offset+15],s_offset+=16,d_offset+=16;return!0};var blkxor=function(D,S,s_offset,
len){len=len<<4|0;var i=0;for(s_offset=s_offset<<4|0;i<len;)D[i]^=S[s_offset],D[i+1]^=S[s_offset+1],D[i+2]^=S[s_offset+2],D[i+3]^=S[s_offset+3],D[i+4]^=S[s_offset+4],D[i+5]^=S[s_offset+5],D[i+6]^=S[s_offset+6],D[i+7]^=S[s_offset+7],D[i+8]^=S[s_offset+8],D[i+9]^=S[s_offset+9],D[i+10]^=S[s_offset+10],D[i+11]^=S[s_offset+11],D[i+12]^=S[s_offset+12],D[i+13]^=S[s_offset+13],D[i+14]^=S[s_offset+14],D[i+15]^=S[s_offset+15],i+=16,s_offset+=16;return!0};var v_endian_reverse=function(v){var _i,_len;var i=_i=
0;for(_len=v.length;_i<_len;i=++_i){var e=v[i];v[i]=endian_reverse(e)}return!0};var Scrypt=function(){function Scrypt(_arg){var N=_arg.N;this.r=_arg.r;this.p=_arg.p;var c=_arg.c;var c0=_arg.c0;var c1=_arg.c1;this.klass=_arg.klass;this.N||(this.N=1<<(N||15));this.r||(this.r=8);this.p||(this.p=1);this.c0=c0||c||1;this.c1=c1||c||1;this.klass||(this.klass=HMAC_SHA256);this.X16_tmp=new Int32Array(16);this.s20ic=new Salsa20InnerCore(8)}Scrypt.prototype.salsa20_8=function(B){var _i,_len;var X=this.s20ic._core(B);
var i=_i=0;for(_len=X.length;_i<_len;i=++_i){var x=X[i];B[i]+=x}return!0};Scrypt.prototype.pbkdf2=function(_arg,cb){var wa,__iced_deferrals;var ___iced_passed_deferral=iced.findDeferral(arguments);var key=_arg.key;var salt=_arg.salt;var dkLen=_arg.dkLen;var progress_hook=_arg.progress_hook;var c=_arg.c;(function(_this){return function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/scrypt.iced",funcname:"Scrypt.pbkdf2"});
pbkdf2({key:key,salt:salt,c:c,dkLen:dkLen,klass:_this.klass,progress_hook:progress_hook},__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p10){return wa=JSCompiler_OptimizeArgumentsArray_p10}}(),lineno:109}));__iced_deferrals._fulfill()}})(this)(function(_this){return function(){return cb(wa)}}(this))};Scrypt.prototype.blockmix_salsa8=function(B,Y){var _i,_ref3;var X=this.X16_tmp;blkcpy(X,B,0,2*this.r-1,1);var i=_i=0;for(_ref3=2*this.r;0<=_ref3?_i<_ref3:
_i>_ref3;i=0<=_ref3?++_i:--_i)blkxor(X,B,i,1),this.salsa20_8(X),blkcpy(Y,X,i,0,1);for(i=0;i<this.r;)blkcpy(B,Y,i,2*i,1),i++;for(i=0;i<this.r;)blkcpy(B,Y,i+this.r,2*i+1,1),i++;return!0};Scrypt.prototype.smix=function(_arg,cb){var j,stop,__iced_deferrals;var ___iced_passed_deferral=iced.findDeferral(arguments);var B=_arg.B;var V=_arg.V;var XY=_arg.XY;var progress_hook=_arg.progress_hook;var lim=2*this.r;var Y=XY.subarray(16*lim);blkcpy(XY,B,0,0,lim);var i=0;(function(_this){return function(__iced_k$jscomp$0){var _while=
function(__iced_k){var _next=function(){return iced.trampoline(function(){return _while(__iced_k)})};if(i<_this.N){for(stop=Math.min(_this.N,i+2048);i<stop;)blkcpy(V,XY,lim*i,0,lim),_this.blockmix_salsa8(XY,Y),i++;"function"===typeof progress_hook&&progress_hook(i);__iced_deferrals=new iced.Deferrals(_next,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/scrypt.iced",funcname:"Scrypt.smix"});default_delay(0,0,__iced_deferrals.defer({lineno:166}));__iced_deferrals._fulfill()}else return __iced_k()};
_while(__iced_k$jscomp$0)}})(this)(function(_this){return function(){i=0;(function(__iced_k$jscomp$0){var _while=function(__iced_k){var _next=function(){return iced.trampoline(function(){return _while(__iced_k)})};if(i<_this.N){for(stop=Math.min(_this.N,i+256);i<stop;)j=fixup_uint32(XY[16*(lim-1)])&_this.N-1,blkxor(XY,V,j*lim,lim),_this.blockmix_salsa8(XY,Y),i++;"function"===typeof progress_hook&&progress_hook(i+_this.N);__iced_deferrals=new iced.Deferrals(_next,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/scrypt.iced",
funcname:"Scrypt.smix"});default_delay(0,0,__iced_deferrals.defer({lineno:183}));__iced_deferrals._fulfill()}else return __iced_k()};_while(__iced_k$jscomp$0)})(function(){blkcpy(B,XY,0,0,lim);return cb()})}}(this))};Scrypt.prototype.run=function(_arg,cb){var B,j$jscomp$0,out,__iced_deferrals,_end,_positive;var ___iced_passed_deferral=iced.findDeferral(arguments);var key=_arg.key;var salt=_arg.salt;var dkLen=_arg.dkLen;var progress_hook=_arg.progress_hook;var XY=new Int32Array(64*this.r);var V=new Int32Array(32*
this.r*this.N);var lph=function(o){o.what+=" (pass 1)";return"function"===typeof progress_hook?progress_hook(o):void 0};(function(_this){return function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/scrypt.iced",funcname:"Scrypt.run"});_this.pbkdf2({key:key.clone(),salt:salt,dkLen:128*_this.r*_this.p,c:_this.c0,progress_hook:lph},__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p11){return B=
JSCompiler_OptimizeArgumentsArray_p11}}(),lineno:214}));__iced_deferrals._fulfill()}})(this)(function(_this){return function(){B=new Int32Array(B.words);v_endian_reverse(B);lph=function(j){return function(i){return"function"===typeof progress_hook?progress_hook({i:i+j*_this.N*2,what:"scrypt",total:_this.p*_this.N*2}):void 0}};(function(__iced_k$jscomp$0){j$jscomp$0=0;_end=_this.p;_positive=0<_end;var _while=function(__iced_k){if(!0===_positive&&j$jscomp$0>=_this.p||!1===_positive&&j$jscomp$0<=_this.p)return __iced_k();
__iced_deferrals=new iced.Deferrals(function(){return iced.trampoline(function(){j$jscomp$0=_positive?j$jscomp$0+1:j$jscomp$0-1;return _while(__iced_k)})},{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/scrypt.iced",funcname:"Scrypt.run"});_this.smix({B:B.subarray(32*_this.r*j$jscomp$0),V:V,XY:XY,progress_hook:lph(j$jscomp$0)},__iced_deferrals.defer({lineno:221}));__iced_deferrals._fulfill()};_while(__iced_k$jscomp$0)})(function(){v_endian_reverse(B);lph=function(o){o.what+=
" (pass 2)";return"function"===typeof progress_hook?progress_hook(o):void 0};(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/scrypt.iced",funcname:"Scrypt.run"});_this.pbkdf2({key:key,salt:WordArray.from_i32a(B),dkLen:dkLen,c:_this.c1,progress_hook:lph},__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p12){return out=JSCompiler_OptimizeArgumentsArray_p12}}(),
lineno:229}));__iced_deferrals._fulfill()})(function(){scrub_vec(XY);scrub_vec(V);scrub_vec(B);key.scrub();return cb(out)})})}}(this))};return Scrypt}();exports.Scrypt=Scrypt;exports.scrypt=function(_arg,cb){var wa,__iced_deferrals;var ___iced_passed_deferral=iced.findDeferral(arguments);var key=_arg.key;var salt=_arg.salt;var r=_arg.r;var N=_arg.N;var p=_arg.p;var c0=_arg.c0;var c1=_arg.c1;var c=_arg.c;var klass=_arg.klass;var progress_hook=_arg.progress_hook;var dkLen=_arg.dkLen;var eng=new Scrypt({r:r,
N:N,p:p,c:c,c0:c0,c1:c1,klass:klass});(function(_this){return function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/scrypt.iced"});eng.run({key:key,salt:salt,progress_hook:progress_hook,dkLen:dkLen},__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p13){return wa=JSCompiler_OptimizeArgumentsArray_p13}}(),lineno:259}));__iced_deferrals._fulfill()}})(this)(function(_this){return function(){return cb(wa)}}(this))};
exports.v_endian_reverse=v_endian_reverse}).call(this)}
//# sourceMappingURL=module$node_modules$triplesec$lib$scrypt.js.map
