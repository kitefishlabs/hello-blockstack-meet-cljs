{
"version":3,
"file":"module$node_modules$blockstack$lib$auth$authApp.js",
"lineCount":15,
"mappings":"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",
"sources":["node_modules/blockstack/lib/auth/authApp.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$blockstack$lib$auth$authApp\"] = function(global,process,require,module,exports,shadow$shims) {\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getTransitKey = getTransitKey;\nexports.generateAndStoreTransitKey = generateAndStoreTransitKey;\nexports.isUserSignedIn = isUserSignedIn;\nexports.redirectToSignInWithAuthRequest = redirectToSignInWithAuthRequest;\nexports.redirectToSignIn = redirectToSignIn;\nexports.getAuthResponseToken = getAuthResponseToken;\nexports.isSignInPending = isSignInPending;\nexports.handlePendingSignIn = handlePendingSignIn;\nexports.loadUserData = loadUserData;\nexports.signUserOut = signUserOut;\n\nvar _queryString = require('query-string');\n\nvar _queryString2 = _interopRequireDefault(_queryString);\n\nvar _jsontokens = require('jsontokens');\n\nvar _customProtocolDetectionBlockstack = require('custom-protocol-detection-blockstack');\n\nvar _customProtocolDetectionBlockstack2 = _interopRequireDefault(_customProtocolDetectionBlockstack);\n\nvar _index = require('./index');\n\nvar _utils = require('../utils');\n\nvar _index2 = require('../index');\n\nvar _errors = require('../errors');\n\nvar _authMessages = require('./authMessages');\n\nvar _authConstants = require('./authConstants');\n\nvar _storage = require('../storage');\n\nvar _profiles = require('../profiles');\n\nvar _logger = require('../logger');\n\nvar _config = require('../config');\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar DEFAULT_PROFILE = {\n  '@type': 'Person',\n  '@context': 'http://schema.org'\n\n  /**\n   * Fetches the hex value of the transit private key from local storage.\n   * @return {String} the hex encoded private key\n   * @private\n   */\n};\nfunction getTransitKey() {\n  var transitKey = localStorage.getItem(_authConstants.BLOCKSTACK_APP_PRIVATE_KEY_LABEL);\n  return transitKey;\n}\n\n/**\n * Generates a ECDSA keypair to\n * use as the ephemeral app transit private key\n * and stores the hex value of the private key in\n * local storage.\n * @return {String} the hex encoded private key\n */\nfunction generateAndStoreTransitKey() {\n  var transitKey = (0, _index2.makeECPrivateKey)();\n  localStorage.setItem(_authConstants.BLOCKSTACK_APP_PRIVATE_KEY_LABEL, transitKey);\n  return transitKey;\n}\n\n/**\n * Check if a user is currently signed in.\n * @return {Boolean} `true` if the user is signed in, `false` if not.\n */\nfunction isUserSignedIn() {\n  return !!window.localStorage.getItem(_authConstants.BLOCKSTACK_STORAGE_LABEL);\n}\n\n/**\n * Redirects the user to the Blockstack browser to approve the sign in request\n * given.\n *\n * The user is redirected to the `blockstackIDHost` if the `blockstack:`\n * protocol handler is not detected. Please note that the protocol handler detection\n * does not work on all browsers.\n * @param  {String} authRequest - the authentication request generated by `makeAuthRequest`\n * @param  {String} blockstackIDHost - the URL to redirect the user to if the blockstack\n *                                     protocol handler is not detected\n * @return {void}\n */\nfunction redirectToSignInWithAuthRequest() {\n  var authRequest = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : (0, _index.makeAuthRequest)();\n  var blockstackIDHost = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : _authConstants.DEFAULT_BLOCKSTACK_HOST;\n\n  var protocolURI = _utils.BLOCKSTACK_HANDLER + ':' + authRequest;\n  var httpsURI = blockstackIDHost + '?authRequest=' + authRequest;\n\n  // If they're on a mobile OS, always redirect them to HTTPS site\n  if (/Android|webOS|iPhone|iPad|iPod|Opera Mini/i.test(navigator.userAgent)) {\n    _logger.Logger.info('detected mobile OS, sending to https');\n    window.location = httpsURI;\n    return;\n  }\n\n  function successCallback() {\n    _logger.Logger.info('protocol handler detected');\n    // protocolCheck should open the link for us\n  }\n\n  function failCallback() {\n    _logger.Logger.warn('protocol handler not detected');\n    window.location = httpsURI;\n  }\n\n  function unsupportedBrowserCallback() {\n    // Safari is unsupported by protocolCheck\n    _logger.Logger.warn('can not detect custom protocols on this browser');\n    window.location = protocolURI;\n  }\n\n  (0, _customProtocolDetectionBlockstack2.default)(protocolURI, failCallback, successCallback, unsupportedBrowserCallback);\n}\n\n/**\n * Generates an authentication request and redirects the user to the Blockstack\n * browser to approve the sign in request.\n *\n * Please note that this requires that the web browser properly handles the\n * `blockstack:` URL protocol handler.\n *\n * Most applications should use this\n * method for sign in unless they require more fine grained control over how the\n * authentication request is generated. If your app falls into this category,\n * use `makeAuthRequest` and `redirectToSignInWithAuthRequest` to build your own sign in process.\n *\n * @param {String} [redirectURI=`${window.location.origin}/`]\n * The location to which the identity provider will redirect the user after\n * the user approves sign in.\n * @param  {String} [manifestURI=`${window.location.origin}/manifest.json`]\n * Location of the manifest file.\n * @param  {Array} [scopes=DEFAULT_SCOPE] Defaults to requesting write access to\n * this app's data store.\n * An array of strings indicating which permissions this app is requesting.\n * @return {void}\n */\nfunction redirectToSignIn() {\n  var redirectURI = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.origin + '/';\n  var manifestURI = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : window.location.origin + '/manifest.json';\n  var scopes = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _authConstants.DEFAULT_SCOPE;\n\n  var authRequest = (0, _index.makeAuthRequest)(generateAndStoreTransitKey(), redirectURI, manifestURI, scopes);\n  redirectToSignInWithAuthRequest(authRequest);\n}\n\n/**\n * Retrieve the authentication token from the URL query\n * @return {String} the authentication token if it exists otherwise `null`\n */\nfunction getAuthResponseToken() {\n  var queryDict = _queryString2.default.parse(location.search);\n  return queryDict.authResponse ? queryDict.authResponse : '';\n}\n\n/**\n * Check if there is a authentication request that hasn't been handled.\n * @return {Boolean} `true` if there is a pending sign in, otherwise `false`\n */\nfunction isSignInPending() {\n  return !!getAuthResponseToken();\n}\n\n/**\n * Try to process any pending sign in request by returning a `Promise` that resolves\n * to the user data object if the sign in succeeds.\n *\n * @param {String} nameLookupURL - the endpoint against which to verify public\n * keys match claimed username\n * @param {String} authResponseToken - the signed authentication response token\n * @param {String} transitKey - the transit private key that corresponds to the transit public key\n * that was provided in the authentication request\n * @return {Promise} that resolves to the user data object if successful and rejects\n * if handling the sign in request fails or there was no pending sign in request.\n */\nfunction handlePendingSignIn() {\n  var nameLookupURL = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var authResponseToken = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getAuthResponseToken();\n  var transitKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : getTransitKey();\n\n  if (!nameLookupURL) {\n    var tokenPayload = (0, _jsontokens.decodeToken)(authResponseToken).payload;\n    if ((0, _utils.isLaterVersion)(tokenPayload.version, '1.3.0') && tokenPayload.blockstackAPIUrl !== null && tokenPayload.blockstackAPIUrl !== undefined) {\n      // override globally\n      _logger.Logger.info('Overriding ' + _config.config.network.blockstackAPIUrl + ' ' + ('with ' + tokenPayload.blockstackAPIUrl));\n      _config.config.network.blockstackAPIUrl = tokenPayload.blockstackAPIUrl;\n      nameLookupURL = tokenPayload.blockstackAPIUrl + '/v1/names';\n    }\n\n    nameLookupURL = _config.config.network.blockstackAPIUrl + '/v1/names/';\n  }\n  return (0, _index.verifyAuthResponse)(authResponseToken, nameLookupURL).then(function (isValid) {\n    if (!isValid) {\n      throw new _errors.LoginFailedError('Invalid authentication response.');\n    }\n    var tokenPayload = (0, _jsontokens.decodeToken)(authResponseToken).payload;\n    // TODO: real version handling\n    var appPrivateKey = tokenPayload.private_key;\n    var coreSessionToken = tokenPayload.core_token;\n    if ((0, _utils.isLaterVersion)(tokenPayload.version, '1.1.0')) {\n      if (transitKey !== undefined && transitKey != null) {\n        if (tokenPayload.private_key !== undefined && tokenPayload.private_key !== null) {\n          try {\n            appPrivateKey = (0, _authMessages.decryptPrivateKey)(transitKey, tokenPayload.private_key);\n          } catch (e) {\n            _logger.Logger.warn('Failed decryption of appPrivateKey, will try to use as given');\n            try {\n              (0, _utils.hexStringToECPair)(tokenPayload.private_key);\n            } catch (ecPairError) {\n              throw new _errors.LoginFailedError('Failed decrypting appPrivateKey. Usually means' + ' that the transit key has changed during login.');\n            }\n          }\n        }\n        if (coreSessionToken !== undefined && coreSessionToken !== null) {\n          try {\n            coreSessionToken = (0, _authMessages.decryptPrivateKey)(transitKey, coreSessionToken);\n          } catch (e) {\n            _logger.Logger.info('Failed decryption of coreSessionToken, will try to use as given');\n          }\n        }\n      } else {\n        throw new _errors.LoginFailedError('Authenticating with protocol > 1.1.0 requires transit' + ' key, and none found.');\n      }\n    }\n    var hubUrl = _authConstants.BLOCKSTACK_DEFAULT_GAIA_HUB_URL;\n    var gaiaAssociationToken = void 0;\n    if ((0, _utils.isLaterVersion)(tokenPayload.version, '1.2.0') && tokenPayload.hubUrl !== null && tokenPayload.hubUrl !== undefined) {\n      hubUrl = tokenPayload.hubUrl;\n    }\n    if ((0, _utils.isLaterVersion)(tokenPayload.version, '1.3.0') && tokenPayload.associationToken !== null && tokenPayload.associationToken !== undefined) {\n      gaiaAssociationToken = tokenPayload.associationToken;\n    }\n\n    var userData = {\n      username: tokenPayload.username,\n      profile: tokenPayload.profile,\n      decentralizedID: tokenPayload.iss,\n      identityAddress: (0, _index2.getAddressFromDID)(tokenPayload.iss),\n      appPrivateKey: appPrivateKey,\n      coreSessionToken: coreSessionToken,\n      authResponseToken: authResponseToken,\n      hubUrl: hubUrl,\n      gaiaAssociationToken: gaiaAssociationToken\n    };\n    var profileURL = tokenPayload.profile_url;\n    if ((userData.profile === null || userData.profile === undefined) && profileURL !== undefined && profileURL !== null) {\n      return fetch(profileURL).then(function (response) {\n        if (!response.ok) {\n          // return blank profile if we fail to fetch\n          userData.profile = Object.assign({}, DEFAULT_PROFILE);\n          window.localStorage.setItem(_authConstants.BLOCKSTACK_STORAGE_LABEL, JSON.stringify(userData));\n          return userData;\n        } else {\n          return response.text().then(function (responseText) {\n            return JSON.parse(responseText);\n          }).then(function (wrappedProfile) {\n            return (0, _profiles.extractProfile)(wrappedProfile[0].token);\n          }).then(function (profile) {\n            userData.profile = profile;\n            window.localStorage.setItem(_authConstants.BLOCKSTACK_STORAGE_LABEL, JSON.stringify(userData));\n            return userData;\n          });\n        }\n      });\n    } else {\n      userData.profile = tokenPayload.profile;\n      window.localStorage.setItem(_authConstants.BLOCKSTACK_STORAGE_LABEL, JSON.stringify(userData));\n      return userData;\n    }\n  });\n}\n\n/**\n * Retrieves the user data object. The user's profile is stored in the key `profile`.\n * @return {Object} User data object.\n */\nfunction loadUserData() {\n  return JSON.parse(window.localStorage.getItem(_authConstants.BLOCKSTACK_STORAGE_LABEL));\n}\n\n/**\n * Sign the user out and optionally redirect to given location.\n * @param  {String} [redirectURL=null] Location to redirect user to after sign out.\n * @return {void}\n */\nfunction signUserOut() {\n  var redirectURL = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n  window.localStorage.removeItem(_authConstants.BLOCKSTACK_STORAGE_LABEL);\n  window.localStorage.removeItem(_storage.BLOCKSTACK_GAIA_HUB_LABEL);\n\n  if (redirectURL !== null) {\n    window.location = redirectURL;\n  }\n}\n};"],
"names":["shadow$provide","global","process","require","module","exports","shadow$shims","getTransitKey","localStorage","getItem","transitKey","_authConstants","BLOCKSTACK_APP_PRIVATE_KEY_LABEL","generateAndStoreTransitKey","_index2","makeECPrivateKey","setItem","redirectToSignInWithAuthRequest","authRequest","arguments","length","undefined","_index","makeAuthRequest","protocolURI","_utils","BLOCKSTACK_HANDLER","httpsURI","blockstackIDHost","DEFAULT_BLOCKSTACK_HOST","test","navigator","userAgent","_logger","Logger","info","window","location","_customProtocolDetectionBlockstack2","default","failCallback","warn","successCallback","unsupportedBrowserCallback","getAuthResponseToken","queryDict","_queryString2","parse","search","authResponse","Object","defineProperty","value","isUserSignedIn","BLOCKSTACK_STORAGE_LABEL","redirectToSignIn","redirectURI","origin","manifestURI","scopes","DEFAULT_SCOPE","isSignInPending","handlePendingSignIn","nameLookupURL","authResponseToken","tokenPayload","_jsontokens","decodeToken","payload","isLaterVersion","version","blockstackAPIUrl","_config","config","network","verifyAuthResponse","then","isValid","_errors","LoginFailedError","appPrivateKey","private_key","coreSessionToken","core_token","_authMessages","decryptPrivateKey","e","hexStringToECPair","ecPairError","hubUrl","BLOCKSTACK_DEFAULT_GAIA_HUB_URL","gaiaAssociationToken","associationToken","userData","username","profile","decentralizedID","iss","identityAddress","getAddressFromDID","profileURL","profile_url","JSON","stringify","fetch","response","ok","text","responseText","wrappedProfile","_profiles","extractProfile","token","assign","DEFAULT_PROFILE","loadUserData","signUserOut","redirectURL","removeItem","_storage","BLOCKSTACK_GAIA_HUB_LABEL","_queryString","__esModule","_customProtocolDetectionBlockstack"]
}
