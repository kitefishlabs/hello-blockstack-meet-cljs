shadow$provide.module$node_modules$bitcoinjs_lib$src$transaction=function(global,process,require,module,exports,shadow$shims){function varSliceSize(someScript){someScript=someScript.length;return varuint.encodingLength(someScript)+someScript}function vectorSize(someVector){return varuint.encodingLength(someVector.length)+someVector.reduce(function(sum,witness){return sum+varSliceSize(witness)},0)}function Transaction(){this.version=1;this.locktime=0;this.ins=[];this.outs=[]}var Buffer=require("module$node_modules$safe_buffer$index").Buffer,
bcrypto=require("module$node_modules$bitcoinjs_lib$src$crypto"),bscript=require("module$node_modules$bitcoinjs_lib$src$script"),bufferutils=require("module$node_modules$bitcoinjs_lib$src$bufferutils"),opcodes=require("module$node_modules$bitcoin_ops$index_json"),typeforce=require("module$node_modules$typeforce$index"),types=require("module$node_modules$bitcoinjs_lib$src$types"),varuint=require("module$node_modules$varuint_bitcoin$index");Transaction.DEFAULT_SEQUENCE=4294967295;Transaction.SIGHASH_ALL=
1;Transaction.SIGHASH_NONE=2;Transaction.SIGHASH_SINGLE=3;Transaction.SIGHASH_ANYONECANPAY=128;Transaction.ADVANCED_TRANSACTION_MARKER=0;Transaction.ADVANCED_TRANSACTION_FLAG=1;var EMPTY_SCRIPT=Buffer.allocUnsafe(0),EMPTY_WITNESS=[],ZERO=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),ONE=Buffer.from("0000000000000000000000000000000000000000000000000000000000000001","hex");global=Buffer.from("ffffffffffffffff","hex");var BLANK_OUTPUT={script:EMPTY_SCRIPT,valueBuffer:global};
Transaction.fromBuffer=function(buffer,__noStrict){function readSlice(n){offset+=n;return buffer.slice(offset-n,offset)}function readUInt32(){var i=buffer.readUInt32LE(offset);offset+=4;return i}function readUInt64(){var i=bufferutils.readUInt64LE(buffer,offset);offset+=8;return i}function readVarInt(){var vi=varuint.decode(buffer,offset);offset+=varuint.decode.bytes;return vi}function readVector(){for(var count=readVarInt(),vector=[],i=0;i<count;i++)vector.push(readSlice(readVarInt()));return vector}
var offset=0,tx=new Transaction;tx.version=function(){var i=buffer.readInt32LE(offset);offset+=4;return i}();var marker=buffer.readUInt8(offset),flag=buffer.readUInt8(offset+1),hasWitnesses=!1;marker===Transaction.ADVANCED_TRANSACTION_MARKER&&flag===Transaction.ADVANCED_TRANSACTION_FLAG&&(offset+=2,hasWitnesses=!0);marker=readVarInt();for(flag=0;flag<marker;++flag)tx.ins.push({hash:readSlice(32),index:readUInt32(),script:readSlice(readVarInt()),sequence:readUInt32(),witness:EMPTY_WITNESS});var voutLen=
readVarInt();for(flag=0;flag<voutLen;++flag)tx.outs.push({value:readUInt64(),script:readSlice(readVarInt())});if(hasWitnesses){for(flag=0;flag<marker;++flag)tx.ins[flag].witness=readVector();if(!tx.hasWitnesses())throw Error("Transaction has superfluous witness data");}tx.locktime=readUInt32();if(__noStrict)return tx;if(offset!==buffer.length)throw Error("Transaction has unexpected data");return tx};Transaction.fromHex=function(hex){return Transaction.fromBuffer(Buffer.from(hex,"hex"))};Transaction.isCoinbaseHash=
function(buffer){typeforce(types.Hash256bit,buffer);for(var i=0;32>i;++i)if(0!==buffer[i])return!1;return!0};Transaction.prototype.isCoinbase=function(){return 1===this.ins.length&&Transaction.isCoinbaseHash(this.ins[0].hash)};Transaction.prototype.addInput=function(hash,index,sequence,scriptSig){typeforce(types.tuple(types.Hash256bit,types.UInt32,types.maybe(types.UInt32),types.maybe(types.Buffer)),arguments);types.Null(sequence)&&(sequence=Transaction.DEFAULT_SEQUENCE);return this.ins.push({hash:hash,
index:index,script:scriptSig||EMPTY_SCRIPT,sequence:sequence,witness:EMPTY_WITNESS})-1};Transaction.prototype.addOutput=function(scriptPubKey,value){typeforce(types.tuple(types.Buffer,types.Satoshi),arguments);return this.outs.push({script:scriptPubKey,value:value})-1};Transaction.prototype.hasWitnesses=function(){return this.ins.some(function(x){return 0!==x.witness.length})};Transaction.prototype.weight=function(){var base=this.__byteLength(!1),total=this.__byteLength(!0);return 3*base+total};Transaction.prototype.virtualSize=
function(){return Math.ceil(this.weight()/4)};Transaction.prototype.byteLength=function(){return this.__byteLength(!0)};Transaction.prototype.__byteLength=function(__allowWitness){__allowWitness=__allowWitness&&this.hasWitnesses();return(__allowWitness?10:8)+varuint.encodingLength(this.ins.length)+varuint.encodingLength(this.outs.length)+this.ins.reduce(function(sum,input){return sum+40+varSliceSize(input.script)},0)+this.outs.reduce(function(sum,output){return sum+8+varSliceSize(output.script)},
0)+(__allowWitness?this.ins.reduce(function(sum,input){return sum+vectorSize(input.witness)},0):0)};Transaction.prototype.clone=function(){var newTx=new Transaction;newTx.version=this.version;newTx.locktime=this.locktime;newTx.ins=this.ins.map(function(txIn){return{hash:txIn.hash,index:txIn.index,script:txIn.script,sequence:txIn.sequence,witness:txIn.witness}});newTx.outs=this.outs.map(function(txOut){return{script:txOut.script,value:txOut.value}});return newTx};Transaction.prototype.hashForSignature=
function(inIndex,prevOutScript,hashType){typeforce(types.tuple(types.UInt32,types.Buffer,types.Number),arguments);if(inIndex>=this.ins.length)return ONE;var ourScript=bscript.compile(bscript.decompile(prevOutScript).filter(function(x){return x!==opcodes.OP_CODESEPARATOR})),txTmp=this.clone();if((hashType&31)===Transaction.SIGHASH_NONE)txTmp.outs=[],txTmp.ins.forEach(function(input,i){i!==inIndex&&(input.sequence=0)});else if((hashType&31)===Transaction.SIGHASH_SINGLE){if(inIndex>=this.outs.length)return ONE;
txTmp.outs.length=inIndex+1;for(var i$jscomp$0=0;i$jscomp$0<inIndex;i$jscomp$0++)txTmp.outs[i$jscomp$0]=BLANK_OUTPUT;txTmp.ins.forEach(function(input,y){y!==inIndex&&(input.sequence=0)})}hashType&Transaction.SIGHASH_ANYONECANPAY?(txTmp.ins=[txTmp.ins[inIndex]],txTmp.ins[0].script=ourScript):(txTmp.ins.forEach(function(input){input.script=EMPTY_SCRIPT}),txTmp.ins[inIndex].script=ourScript);ourScript=Buffer.allocUnsafe(txTmp.__byteLength(!1)+4);ourScript.writeInt32LE(hashType,ourScript.length-4);txTmp.__toBuffer(ourScript,
0,!1);return bcrypto.hash256(ourScript)};Transaction.prototype.hashForWitnessV0=function(inIndex,prevOutScript,value,hashType){function writeSlice(slice){toffset+=slice.copy(tbuffer,toffset)}function writeUInt32(i){toffset=tbuffer.writeUInt32LE(i,toffset)}function writeUInt64(i){toffset=bufferutils.writeUInt64LE(tbuffer,i,toffset)}function writeVarSlice(slice){varuint.encode(slice.length,tbuffer,toffset);toffset+=varuint.encode.bytes;writeSlice(slice)}typeforce(types.tuple(types.UInt32,types.Buffer,
types.Satoshi,types.UInt32),arguments);var hashOutputs=ZERO,hashPrevouts=ZERO,hashSequence=ZERO;if(!(hashType&Transaction.SIGHASH_ANYONECANPAY)){var tbuffer=Buffer.allocUnsafe(36*this.ins.length);var toffset=0;this.ins.forEach(function(txIn){writeSlice(txIn.hash);writeUInt32(txIn.index)});hashPrevouts=bcrypto.hash256(tbuffer)}hashType&Transaction.SIGHASH_ANYONECANPAY||(hashType&31)===Transaction.SIGHASH_SINGLE||(hashType&31)===Transaction.SIGHASH_NONE||(tbuffer=Buffer.allocUnsafe(4*this.ins.length),
toffset=0,this.ins.forEach(function(txIn){writeUInt32(txIn.sequence)}),hashSequence=bcrypto.hash256(tbuffer));(hashType&31)!==Transaction.SIGHASH_SINGLE&&(hashType&31)!==Transaction.SIGHASH_NONE?(hashOutputs=this.outs.reduce(function(sum,output){return sum+8+varSliceSize(output.script)},0),tbuffer=Buffer.allocUnsafe(hashOutputs),toffset=0,this.outs.forEach(function(out){writeUInt64(out.value);writeVarSlice(out.script)}),hashOutputs=bcrypto.hash256(tbuffer)):(hashType&31)===Transaction.SIGHASH_SINGLE&&
inIndex<this.outs.length&&(hashOutputs=this.outs[inIndex],tbuffer=Buffer.allocUnsafe(8+varSliceSize(hashOutputs.script)),toffset=0,writeUInt64(hashOutputs.value),writeVarSlice(hashOutputs.script),hashOutputs=bcrypto.hash256(tbuffer));tbuffer=Buffer.allocUnsafe(156+varSliceSize(prevOutScript));toffset=0;var input=this.ins[inIndex];writeUInt32(this.version);writeSlice(hashPrevouts);writeSlice(hashSequence);writeSlice(input.hash);writeUInt32(input.index);writeVarSlice(prevOutScript);writeUInt64(value);
writeUInt32(input.sequence);writeSlice(hashOutputs);writeUInt32(this.locktime);writeUInt32(hashType);return bcrypto.hash256(tbuffer)};Transaction.prototype.getHash=function(){return bcrypto.hash256(this.__toBuffer(void 0,void 0,!1))};Transaction.prototype.getId=function(){return this.getHash().reverse().toString("hex")};Transaction.prototype.toBuffer=function(buffer,initialOffset){return this.__toBuffer(buffer,initialOffset,!0)};Transaction.prototype.__toBuffer=function(buffer,initialOffset,__allowWitness){function writeSlice(slice){offset+=
slice.copy(buffer,offset)}function writeVarInt(i){varuint.encode(i,buffer,offset);offset+=varuint.encode.bytes}function writeVarSlice(slice){writeVarInt(slice.length);writeSlice(slice)}buffer||(buffer=Buffer.allocUnsafe(this.__byteLength(__allowWitness)));var offset=initialOffset||0;offset=buffer.writeInt32LE(this.version,offset);if(__allowWitness=__allowWitness&&this.hasWitnesses())offset=buffer.writeUInt8(Transaction.ADVANCED_TRANSACTION_MARKER,offset),offset=buffer.writeUInt8(Transaction.ADVANCED_TRANSACTION_FLAG,
offset);writeVarInt(this.ins.length);this.ins.forEach(function(txIn){writeSlice(txIn.hash);offset=buffer.writeUInt32LE(txIn.index,offset);writeVarSlice(txIn.script);offset=buffer.writeUInt32LE(txIn.sequence,offset)});writeVarInt(this.outs.length);this.outs.forEach(function(txOut){txOut.valueBuffer?writeSlice(txOut.valueBuffer):offset=bufferutils.writeUInt64LE(buffer,txOut.value,offset);writeVarSlice(txOut.script)});__allowWitness&&this.ins.forEach(function(input){input=input.witness;writeVarInt(input.length);
input.forEach(writeVarSlice)});offset=buffer.writeUInt32LE(this.locktime,offset);return void 0!==initialOffset?buffer.slice(initialOffset,offset):buffer};Transaction.prototype.toHex=function(){return this.toBuffer().toString("hex")};Transaction.prototype.setInputScript=function(index,scriptSig){typeforce(types.tuple(types.Number,types.Buffer),arguments);this.ins[index].script=scriptSig};Transaction.prototype.setWitness=function(index,witness){typeforce(types.tuple(types.Number,[types.Buffer]),arguments);
this.ins[index].witness=witness};module.exports=Transaction}
//# sourceMappingURL=module$node_modules$bitcoinjs_lib$src$transaction.js.map
