shadow$provide.module$node_modules$triplesec$lib$drbg=function(global,process,require,module,exports,shadow$shims){(function(){var iced=require("module$node_modules$iced_runtime$lib$main");var hmac$jscomp$0=require("module$node_modules$triplesec$lib$hmac");require("module$node_modules$triplesec$lib$combine");require("module$node_modules$triplesec$lib$sha512");require("module$node_modules$triplesec$lib$sha3");var WordArray=require("module$node_modules$triplesec$lib$wordarray").WordArray;var Lock=require("module$node_modules$iced_lock$index").Lock;
var DRBG=function(){function DRBG(entropy,personalization_string,hmac_func){this.hmac=hmac_func||hmac$jscomp$0.sign;this.security_strength=256;entropy=this.check_entropy(entropy);personalization_string||(personalization_string=new WordArray([]));this._instantiate(entropy,personalization_string)}DRBG.prototype.check_entropy=function(entropy,reseed){null==reseed&&(reseed=!1);if(16*entropy.sigBytes<(reseed?2:3)*this.security_strength)throw Error("entropy must be at least "+1.5*this.security_strength+
" bits.");return entropy};DRBG.prototype._hmac=function(key,input){return this.hmac({key:key,input:input})};DRBG.prototype._update=function(provided_data){var V=new WordArray([0],1);null!=provided_data&&(V=V.concat(provided_data));var V_in=this.V.clone().concat(V);this.K=this._hmac(this.K,V_in);V_in.scrub();V.scrub();this.V=this._hmac(this.K,this.V);null!=provided_data&&(V_in=this.V.clone().concat(new WordArray([16777216],1)).concat(provided_data),this.K=this._hmac(this.K,V_in),V_in.scrub(),this.V=
this._hmac(this.K,this.V));return null!=provided_data?provided_data.scrub():void 0};DRBG.prototype._instantiate=function(entropy,personalization_string){personalization_string=entropy.concat(personalization_string);this.K=WordArray.from_buffer(new shadow$shims.Buffer(function(){var _i;var _results=[];for(_i=0;64>_i;++_i)_results.push(0);return _results}()));this.V=WordArray.from_buffer(new shadow$shims.Buffer(function(){var _i;var _results=[];for(_i=0;64>_i;++_i)_results.push(1);return _results}()));
this._update(personalization_string);entropy.scrub();return this.reseed_counter=1};DRBG.prototype.reseed=function(entropy){this._update(this.check_entropy(entropy,!0));return this.reseed_counter=1};DRBG.prototype.generate=function(num_bytes){var tmp,_ref;if(7500<8*num_bytes)throw Error("generate cannot generate \x3e 7500 bits in 1 call.");if(1E4<=this.reseed_counter)throw Error("Need a reseed!");for(tmp=[];0===tmp.length||tmp.length*tmp[0].length*4<num_bytes;)this.V=this._hmac(this.K,this.V),tmp.push(this.V.words);
this._update();this.reseed_counter+=1;return(new WordArray((_ref=[]).concat.apply(_ref,tmp))).truncate(num_bytes)};return DRBG}();var ADRBG=function(){function ADRBG(gen_seed,hmac){this.gen_seed=gen_seed;this.hmac=hmac;this.drbg=null;this.lock=new Lock}ADRBG.prototype.generate=function(n,cb){var ret,seed,__iced_deferrals;var ___iced_passed_deferral=iced.findDeferral(arguments);(function(_this){return function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/drbg.iced",
funcname:"ADRBG.generate"});_this.lock.acquire(__iced_deferrals.defer({lineno:148}));__iced_deferrals._fulfill()}})(this)(function(_this){return function(){(function(__iced_k$jscomp$0){if(null==_this.drbg)(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/drbg.iced",funcname:"ADRBG.generate"});_this.gen_seed(256,__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p14){return seed=
JSCompiler_OptimizeArgumentsArray_p14}}(),lineno:150}));__iced_deferrals._fulfill()})(function(){return __iced_k$jscomp$0(_this.drbg=new DRBG(seed,null,_this.hmac))});else return __iced_k$jscomp$0()})(function(){(function(__iced_k$jscomp$0){if(100<_this.drbg.reseed_counter)(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/drbg.iced",funcname:"ADRBG.generate"});_this.gen_seed(256,__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p15){return seed=
JSCompiler_OptimizeArgumentsArray_p15}}(),lineno:153}));__iced_deferrals._fulfill()})(function(){return __iced_k$jscomp$0(_this.drbg.reseed(seed))});else return __iced_k$jscomp$0()})(function(){ret=_this.drbg.generate(n);_this.lock.release();return cb(ret)})})}}(this))};return ADRBG}();exports.DRBG=DRBG;exports.ADRBG=ADRBG}).call(this)}
//# sourceMappingURL=module$node_modules$triplesec$lib$drbg.js.map
