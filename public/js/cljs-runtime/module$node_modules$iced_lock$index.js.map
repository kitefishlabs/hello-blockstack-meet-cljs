{
"version":3,
"file":"module$node_modules$iced_lock$index.js",
"lineCount":8,
"mappings":"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",
"sources":["node_modules/iced-lock/index.js"],
"sourcesContent":["shadow$provide[\"module$node_modules$iced_lock$index\"] = function(global,process,require,module,exports,shadow$shims) {\n// Generated by IcedCoffeeScript 108.0.11\n(function() {\n  var Lock, NamedLock, SingleFlightTable, SingleFlighter, Table, iced, __iced_k, __iced_k_noop,\n    __hasProp = {}.hasOwnProperty,\n    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\n  iced = require('iced-runtime');\n  __iced_k = __iced_k_noop = function() {};\n\n  exports.Lock = Lock = (function() {\n    function Lock() {\n      this._open = true;\n      this._waiters = [];\n    }\n\n    Lock.prototype.acquire = function(cb) {\n      if (this._open) {\n        this._open = false;\n        return cb();\n      } else {\n        return this._waiters.push(cb);\n      }\n    };\n\n    Lock.prototype.release = function() {\n      var w;\n      if (this._waiters.length) {\n        w = this._waiters.shift();\n        return w();\n      } else {\n        return this._open = true;\n      }\n    };\n\n    Lock.prototype.open = function() {\n      return this._open;\n    };\n\n    return Lock;\n\n  })();\n\n  NamedLock = (function(_super) {\n    __extends(NamedLock, _super);\n\n    function NamedLock(tab, name) {\n      this.tab = tab;\n      this.name = name;\n      NamedLock.__super__.constructor.call(this);\n      this.refs = 0;\n    }\n\n    NamedLock.prototype.incref = function() {\n      return ++this.refs;\n    };\n\n    NamedLock.prototype.decref = function() {\n      return --this.refs;\n    };\n\n    NamedLock.prototype.release = function() {\n      NamedLock.__super__.release.call(this);\n      if (this.decref() === 0) {\n        return delete this.tab.locks[this.name];\n      }\n    };\n\n    return NamedLock;\n\n  })(Lock);\n\n  exports.Table = Table = (function() {\n    function Table() {\n      this.locks = {};\n    }\n\n    Table.prototype.create = function(name) {\n      var l;\n      l = new NamedLock(this, name);\n      return this.locks[name] = l;\n    };\n\n    Table.prototype.acquire = function(name, cb, wait) {\n      var l, was_open, ___iced_passed_deferral, __iced_deferrals, __iced_k;\n      __iced_k = __iced_k_noop;\n      ___iced_passed_deferral = iced.findDeferral(arguments);\n      l = this.locks[name] || this.create(name);\n      was_open = l._open;\n      l.incref();\n      (function(_this) {\n        return (function(__iced_k) {\n          if (wait || l._open) {\n            (function(__iced_k) {\n              __iced_deferrals = new iced.Deferrals(__iced_k, {\n                parent: ___iced_passed_deferral,\n                filename: \"/Users/max/src/iced/iced-lock/index.iced\",\n                funcname: \"Table.acquire\"\n              });\n              l.acquire(__iced_deferrals.defer({\n                lineno: 69\n              }));\n              __iced_deferrals._fulfill();\n            })(__iced_k);\n          } else {\n            return __iced_k(l = null);\n          }\n        });\n      })(this)((function(_this) {\n        return function() {\n          return cb(l, was_open);\n        };\n      })(this));\n    };\n\n    Table.prototype.lookup = function(name) {\n      return this.locks[name];\n    };\n\n    return Table;\n\n  })();\n\n  SingleFlighter = (function() {\n    function SingleFlighter(_arg) {\n      this.table = _arg.table, this.key = _arg.key;\n      this.seqid = null;\n      this.waiter = null;\n      this.open = true;\n      this.refs = 0;\n    }\n\n    SingleFlighter.prototype._incref = function() {\n      return ++this.refs;\n    };\n\n    SingleFlighter.prototype._decref = function() {\n      if (--this.refs === 0) {\n        return this.table._remove({\n          key: this.key\n        });\n      }\n    };\n\n    SingleFlighter.prototype._enter = function(_arg, cb) {\n      var seqid, tmp;\n      seqid = _arg.seqid;\n      if (this.open) {\n        this.open = false;\n        this.seqid = seqid;\n        return cb(null, this);\n      } else if (this.waiter != null) {\n        if (seqid > this.waiter.seqid) {\n          tmp = this.waiter;\n          this.waiter = {\n            cb: cb,\n            seqid: seqid\n          };\n          tmp.cb(new Error(\"our seqid=\" + tmp.seqid + \" was preempted by \" + seqid));\n        } else {\n          cb(new Error(\"our seqid=\" + seqid + \" is too stale (since \" + this.waiter.seqid + \" is ahead of us)\"));\n        }\n        return this._decref();\n      } else if (seqid > this.seqid) {\n        return this.waiter = {\n          seqid: seqid,\n          cb: cb\n        };\n      } else {\n        cb(new Error(\"our seqid=\" + seqid + \" is too stale (since \" + this.seqid + \" is already in flight)\"));\n        return this._decref();\n      }\n    };\n\n    SingleFlighter.prototype.release = function() {\n      var cb, _ref;\n      if (this.waiter != null) {\n        _ref = this.waiter, this.seqid = _ref.seqid, cb = _ref.cb;\n        this.waiter = null;\n        cb(null, this);\n      } else {\n        this.open = true;\n        this.seqid = null;\n      }\n      return this._decref();\n    };\n\n    return SingleFlighter;\n\n  })();\n\n  exports.SingleFlightTable = SingleFlightTable = (function() {\n    function SingleFlightTable() {\n      this._jobs = {};\n    }\n\n    SingleFlightTable.prototype._create = function(_arg) {\n      var key;\n      key = _arg.key;\n      return this._jobs[key] = new SingleFlighter({\n        table: this,\n        key: key\n      });\n    };\n\n    SingleFlightTable.prototype._remove = function(_arg) {\n      var key;\n      key = _arg.key;\n      return delete this._jobs[key];\n    };\n\n    SingleFlightTable.prototype.enter = function(_arg, cb) {\n      var key, s, seqid;\n      seqid = _arg.seqid, key = _arg.key;\n      s = this._jobs[key] || this._create({\n        key: key\n      });\n      s._incref();\n      return s._enter({\n        seqid: seqid\n      }, cb);\n    };\n\n    return SingleFlightTable;\n\n  })();\n\n}).call(this);\n\n};"],
"names":["shadow$provide","global","process","require","module","exports","shadow$shims","Lock","__hasProp","hasOwnProperty","__extends","child","parent","ctor","constructor","key","call","prototype","__super__","iced","_open","_waiters","acquire","Lock.prototype.acquire","cb","push","release","Lock.prototype.release","length","w","shift","open","Lock.prototype.open","NamedLock","_super","tab","name","refs","incref","NamedLock.prototype.incref","decref","NamedLock.prototype.decref","NamedLock.prototype.release","locks","Table","create","Table.prototype.create","l","Table.prototype.acquire","wait","__iced_deferrals","___iced_passed_deferral","findDeferral","arguments","was_open","_this","__iced_k","Deferrals","filename","funcname","defer","lineno","_fulfill","lookup","Table.prototype.lookup","SingleFlighter","_arg","table","waiter","seqid","_incref","SingleFlighter.prototype._incref","_decref","SingleFlighter.prototype._decref","_remove","_enter","SingleFlighter.prototype._enter","tmp","Error","SingleFlighter.prototype.release","_ref","SingleFlightTable","_jobs","_create","SingleFlightTable.prototype._create","SingleFlightTable.prototype._remove","enter","SingleFlightTable.prototype.enter","s"]
}
