{"version":3,"sources":["cljs/core/async/impl/dispatch.cljs"],"sourcesContent":["(ns cljs.core.async.impl.dispatch\n  (:require [cljs.core.async.impl.buffers :as buffers]\n            [goog.async.nextTick]))\n\n(def tasks (buffers/ring-buffer 32))\n(def running? false)\n(def queued? false)\n\n(def TASK_BATCH_SIZE 1024)\n\n(declare queue-dispatcher)\n\n(defn process-messages []\n  (set! running? true)\n  (set! queued? false)\n  (loop [count 0]\n    (let [m (.pop tasks)]\n      (when-not (nil? m)\n        (m)\n        (when (< count TASK_BATCH_SIZE)\n          (recur (inc count))))))\n  (set! running? false)\n  (when (> (.-length tasks) 0)\n    (queue-dispatcher)))\n\n(defn queue-dispatcher []\n  (when-not (and queued? running?)\n    (set! queued? true)\n    (goog.async.nextTick process-messages)))\n\n(defn run [f]\n  (.unbounded-unshift tasks f)\n  (queue-dispatcher))\n\n(defn queue-delay [f delay]\n  (js/setTimeout f delay))\n\n"],"mappings":";;;;AAIA,AAAKA,AAAM,AAAA,AAACC;AACZ,AAAA,AAAKC;AACL,AAAA,AAAKC;AAEL,AAAA,AAAKC;AAEL,AAAA,AAEA,AAAA,AAAMC;AAAN,AACE,AAAA,AAAMH;;AACN,AAAA,AAAMC;;AACN,AAAA,AAAO;;AAAP,AACE,AAAM,AAAE,AAAMH;AAAd,AACE,AAAU,AAAA,AAAMM;AAAhB;AAAA,AACE,AAACA,AAAAA,AAAAA;;AACD,AAAM,AAAGC,AAAMH;AAAf,AACE,AAAO,AAAA,AAAKG;;;;AADd;;;;;AAEN,AAAA,AAAML;;AACN,AAAM,AAAA,AAAG,AAAUF;AAAnB,AACE,AAACQ,AAAAA,AAAAA;;AADH;;;AAGF,AAAA,AAAMA;AAAN,AACE,AAAU,AAAKL,AAAQD;AAAvB;;AAAA,AACE,AAAA,AAAMC;;AACN,AAACM,AAAoBJ;;;AAEzB,AAAA,AAAMK,AAAK;AAAX,AACE,AAAoBV,AAAMW;;AAC1B,AAACH;;AAEH,AAAA,AAAMI,AAAa,AAAE;AAArB,AACE,AAACC,AAAcF,AAAEG","names":["cljs.core.async.impl.dispatch/tasks","cljs.core.async.impl.buffers/ring-buffer","cljs.core.async.impl.dispatch/running?","cljs.core.async.impl.dispatch/queued?","cljs.core.async.impl.dispatch/TASK_BATCH_SIZE","cljs.core.async.impl.dispatch/process-messages","m","count","cljs.core.async.impl.dispatch/queue-dispatcher","goog.async/nextTick","cljs.core.async.impl.dispatch/run","f","cljs.core.async.impl.dispatch/queue-delay","js/setTimeout","delay"]}