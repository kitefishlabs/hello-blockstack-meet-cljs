shadow$provide.module$node_modules$triplesec$lib$dec=function(global,process,require,module,exports,shadow$shims){(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};var iced=require("module$node_modules$iced_runtime$lib$main");var WordArray=require("module$node_modules$triplesec$lib$wordarray").WordArray;
require("module$node_modules$triplesec$lib$salsa20");var AES=require("module$node_modules$triplesec$lib$aes").AES;var TwoFish=require("module$node_modules$triplesec$lib$twofish").TwoFish;require("module$node_modules$triplesec$lib$ctr");var Concat=require("module$node_modules$triplesec$lib$combine").Concat;require("module$node_modules$triplesec$lib$sha512");var Salsa20=require("module$node_modules$triplesec$lib$salsa20").Salsa20;var _ref=require("module$node_modules$triplesec$lib$enc");var Base=_ref.Base;
var V=_ref.V;var make_esc=require("module$node_modules$iced_error$index").make_esc;var Decryptor=function(_super){function Decryptor(_arg){var key=_arg.key;_arg=_arg.enc;Decryptor.__super__.constructor.call(this,{key:key});null!=_arg&&(this.key=_arg.key,this.derived_keys=_arg.derived_keys)}__extends(Decryptor,_super);Decryptor.prototype.read_header=function(cb){var wa;var err=null==(wa=this.ct.unshift(2))?Error("Ciphertext underrun in header"):null==(this.version=V[wa.words[1]])?Error("bad header; couldn't find a good version (got "+
wa.words[1]+")"):wa.words[0]!==this.version.header[0]?Error("Bad header: unrecognized magic value"):null;return cb(err)};Decryptor.prototype.verify_sig=function(key,cb){var computed,err,received,__iced_deferrals;var ___iced_passed_deferral=iced.findDeferral(arguments);(function(_this){return function(__iced_k$jscomp$0){if(null==(received=_this.ct.unshift(Concat.get_output_size()/4)))return __iced_k$jscomp$0(err=Error("Ciphertext underrun in signature"));(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,
{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.verify_sig"});_this.sign({input:_this.ct,key:key,salt:_this.salt},__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p33,JSCompiler_OptimizeArgumentsArray_p34){err=JSCompiler_OptimizeArgumentsArray_p33;return computed=JSCompiler_OptimizeArgumentsArray_p34}}(),lineno:63}));__iced_deferrals._fulfill()})(function(){return __iced_k$jscomp$0(err=null!=
err?err:received.equal(computed)?null:Error("Signature mismatch or bad decryption key"))})}})(this)(function(_this){return function(){return cb(err)}}(this))};Decryptor.prototype.unshift_iv=function(n_bytes,which,cb){which=null!=(n_bytes=this.ct.unshift(n_bytes/4))?null:Error("Ciphertext underrun in "+which);return cb(which,n_bytes)};Decryptor.prototype.read_salt=function(cb){var err=null==(this.salt=this.ct.unshift(this.version.salt_size/4))?Error("Ciphertext underrrun in read_salt"):null;return cb(err)};
Decryptor.prototype.generate_keys=function(_arg,cb){var err,keys,__iced_deferrals;var ___iced_passed_deferral=iced.findDeferral(arguments);var progress_hook=_arg.progress_hook;(function(_this){return function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.generate_keys"});_this.kdf({salt:_this.salt,progress_hook:progress_hook},__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p35,
JSCompiler_OptimizeArgumentsArray_p36){err=JSCompiler_OptimizeArgumentsArray_p35;return keys=JSCompiler_OptimizeArgumentsArray_p36}}(),lineno:114}));__iced_deferrals._fulfill()}})(this)(function(_this){return function(){return cb(err,keys)}}(this))};Decryptor.prototype.run=function(_arg,cb){var iv,pt,__iced_deferrals;var ___iced_passed_deferral=iced.findDeferral(arguments);var data=_arg.data;var progress_hook=_arg.progress_hook;var esc=make_esc(cb,"Decryptor::run");this.ct=WordArray.from_buffer(data);
(function(_this){return function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});_this.read_header(esc(__iced_deferrals.defer({lineno:141})));__iced_deferrals._fulfill()}})(this)(function(_this){return function(){(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});
_this.read_salt(esc(__iced_deferrals.defer({lineno:142})));__iced_deferrals._fulfill()})(function(){(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});_this.generate_keys({progress_hook:progress_hook},esc(__iced_deferrals.defer({assign_fn:function(__slot_1){return function(JSCompiler_OptimizeArgumentsArray_p37){return __slot_1.keys=JSCompiler_OptimizeArgumentsArray_p37}}(_this),
lineno:143})));__iced_deferrals._fulfill()})(function(){(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});_this.verify_sig(_this.keys.hmac,esc(__iced_deferrals.defer({lineno:144})));__iced_deferrals._fulfill()})(function(){(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",
funcname:"Decryptor.run"});_this.unshift_iv(AES.ivSize,"AES",esc(__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p38){return iv=JSCompiler_OptimizeArgumentsArray_p38}}(),lineno:145})));__iced_deferrals._fulfill()})(function(){(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});_this.run_aes({iv:iv,input:_this.ct,key:_this.keys.aes,
progress_hook:progress_hook},esc(__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p39){return JSCompiler_OptimizeArgumentsArray_p39}}(),lineno:146})));__iced_deferrals._fulfill()})(function(){(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});_this.unshift_iv(TwoFish.ivSize,"2fish",esc(__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p40){return iv=
JSCompiler_OptimizeArgumentsArray_p40}}(),lineno:147})));__iced_deferrals._fulfill()})(function(){(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});_this.run_twofish({iv:iv,input:_this.ct,key:_this.keys.twofish,progress_hook:progress_hook},esc(__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p41){return JSCompiler_OptimizeArgumentsArray_p41}}(),
lineno:148})));__iced_deferrals._fulfill()})(function(){(function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});_this.unshift_iv(Salsa20.ivSize,"Salsa",esc(__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p42){return iv=JSCompiler_OptimizeArgumentsArray_p42}}(),lineno:149})));__iced_deferrals._fulfill()})(function(){(function(__iced_k){__iced_deferrals=
new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced",funcname:"Decryptor.run"});_this.run_salsa20({iv:iv,input:_this.ct,key:_this.keys.salsa20,output_iv:!1,progress_hook:progress_hook},esc(__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p43){return pt=JSCompiler_OptimizeArgumentsArray_p43}}(),lineno:150})));__iced_deferrals._fulfill()})(function(){return cb(null,pt.to_buffer())})})})})})})})})})}}(this))};
Decryptor.prototype.clone=function(){var _ref1;var ret=new Decryptor({key:null!=(_ref1=this.key)?_ref1.to_buffer():void 0,rng:this.rng,version:this.version});ret.derived_keys=this.clone_derived_keys();return ret};return Decryptor}(Base);exports.Decryptor=Decryptor;exports.decrypt=function(_arg,cb){var err,pt,__iced_deferrals;var ___iced_passed_deferral=iced.findDeferral(arguments);var key=_arg.key;var data=_arg.data;var progress_hook=_arg.progress_hook;var dec=new Decryptor({key:key});(function(_this){return function(__iced_k){__iced_deferrals=
new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/dec.iced"});dec.run({data:data,progress_hook:progress_hook},__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p44,JSCompiler_OptimizeArgumentsArray_p45){err=JSCompiler_OptimizeArgumentsArray_p44;return pt=JSCompiler_OptimizeArgumentsArray_p45}}(),lineno:180}));__iced_deferrals._fulfill()}})(this)(function(_this){return function(){dec.scrub();return cb(err,
pt)}}(this))}}).call(this)}
//# sourceMappingURL=module$node_modules$triplesec$lib$dec.js.map
