shadow$provide.module$node_modules$triplesec$lib$twofish=function(global,process,require,module,exports,shadow$shims){(function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};var BlockCipher=require("module$node_modules$triplesec$lib$algbase").BlockCipher;var scrub_vec=
require("module$node_modules$triplesec$lib$util").scrub_vec;var G=new (function(){return function(){this.P=[[169,103,179,232,4,253,163,118,154,146,128,120,228,221,209,56,13,198,53,152,24,247,236,108,67,117,55,38,250,19,148,72,242,208,139,48,132,84,223,35,25,91,61,89,243,174,162,130,99,1,131,46,217,81,155,124,166,235,165,190,22,12,227,97,192,140,58,245,115,44,37,11,187,78,137,107,83,106,180,241,225,230,189,69,226,244,182,102,204,149,3,86,212,28,30,215,251,195,142,181,233,207,191,186,234,119,57,175,
51,201,98,113,129,121,9,173,36,205,249,216,229,197,185,77,68,8,134,231,161,29,170,237,6,112,178,210,65,123,160,17,49,194,39,144,32,246,96,255,150,92,177,171,158,156,82,27,95,147,10,239,145,133,73,238,45,79,143,59,71,135,109,70,214,62,105,100,42,206,203,47,252,151,5,122,172,127,213,26,75,14,167,90,40,20,63,41,136,60,76,2,184,218,176,23,85,31,138,125,87,199,141,116,183,196,159,114,126,21,34,18,88,7,153,52,110,80,222,104,101,188,219,248,200,168,43,64,220,254,50,164,202,16,33,240,211,93,15,0,111,157,
54,66,74,94,193,224],[117,243,198,244,219,123,251,200,74,211,230,107,69,125,232,75,214,50,216,253,55,113,241,225,48,15,248,27,135,250,6,63,94,186,174,91,138,0,188,157,109,193,177,14,128,93,210,213,160,132,7,20,181,144,44,163,178,115,76,84,146,116,54,81,56,176,189,90,252,96,98,150,108,66,247,16,124,40,39,140,19,149,156,199,36,70,59,112,202,227,133,203,17,208,147,184,166,131,32,255,159,119,195,204,3,111,8,191,64,231,43,226,121,12,170,130,65,58,234,185,228,154,164,151,126,218,122,23,102,148,161,29,61,
240,222,179,11,114,167,28,239,209,83,62,143,51,38,95,236,118,42,73,129,136,238,33,196,26,235,217,197,57,153,205,173,49,139,1,24,35,221,31,78,45,249,72,79,242,101,142,120,92,88,25,141,229,152,87,103,127,5,100,175,99,182,254,245,183,60,165,206,233,104,68,224,77,67,105,41,46,172,21,89,168,10,158,110,71,223,52,53,106,207,220,34,201,192,155,137,212,237,171,18,162,13,82,187,2,47,169,215,97,30,180,80,4,246,194,22,37,134,86,85,9,190,145]];this.P_00=1;this.P_02=this.P_01=0;this.P_04=this.P_03=1;this.P_11=
this.P_10=0;this.P_13=this.P_12=1;this.P_14=0;this.P_21=this.P_20=1;this.P_30=this.P_24=this.P_23=this.P_22=0;this.P_32=this.P_31=1;this.P_33=0;this.P_34=1;this.GF256_FDBK=361;this.GF256_FDBK_2=this.GF256_FDBK/2;this.GF256_FDBK_4=this.GF256_FDBK/4;this.RS_GF_FDBK=333;this.SK_STEP=33686018;this.SK_BUMP=16843009;this.SK_ROTL=9}}());exports.TwoFish=function(_super){function TwoFish(key){this._key=key.clone();this.gMDS0=[];this.gMDS1=[];this.gMDS2=[];this.gMDS3=[];this.gSubKeys=[];this.gSBox=[];this.k64Cnt=
0;this._doReset()}__extends(TwoFish,_super);TwoFish.blockSize=16;TwoFish.prototype.blockSize=TwoFish.blockSize;TwoFish.keySize=32;TwoFish.prototype.keySize=TwoFish.keySize;TwoFish.ivSize=TwoFish.blockSize;TwoFish.prototype.ivSize=TwoFish.ivSize;TwoFish.prototype.getByte=function(x,n){return x>>>8*n&255};TwoFish.prototype.switchEndianness=function(word){return(word&255)<<24|(word>>8&255)<<16|(word>>16&255)<<8|word>>24&255};TwoFish.prototype.LFSR1=function(x){return x>>1^(0!==(x&1)?G.GF256_FDBK_2:0)};
TwoFish.prototype.LFSR2=function(x){return x>>2^(0!==(x&2)?G.GF256_FDBK_2:0)^(0!==(x&1)?G.GF256_FDBK_4:0)};TwoFish.prototype.Mx_X=function(x){return x^this.LFSR2(x)};TwoFish.prototype.Mx_Y=function(x){return x^this.LFSR1(x)^this.LFSR2(x)};TwoFish.prototype.RS_rem=function(x){var b=x>>>24&255;var g2=(b<<1^(0!==(b&128)?G.RS_GF_FDBK:0))&255;var g3=b>>>1^(0!==(b&1)?G.RS_GF_FDBK>>>1:0)^g2;return x<<8^g3<<24^g2<<16^g3<<8^b};TwoFish.prototype.RS_MDS_Encode=function(k0,k1){var _i;for(_i=0;4>_i;++_i)k1=this.RS_rem(k1);
k1^=k0;for(k0=0;4>k0;++k0)k1=this.RS_rem(k1);return k1};TwoFish.prototype.F32=function(x,k32){var b0=this.getByte(x,0);var b1=this.getByte(x,1);var b2=this.getByte(x,2);x=this.getByte(x,3);var k0=k32[0];var k1=k32[1];var k2=k32[2];k32=k32[3];var m=this.k64Cnt&3;return 1===m?this.gMDS0[G.P[G.P_01][b0]&255^this.getByte(k0,0)]^this.gMDS1[G.P[G.P_11][b1]&255^this.getByte(k0,1)]^this.gMDS2[G.P[G.P_21][b2]&255^this.getByte(k0,2)]^this.gMDS3[G.P[G.P_31][x]&255^this.getByte(k0,3)]:(0===m?(b0=G.P[G.P_04][b0]&
255^this.getByte(k32,0),b1=G.P[G.P_14][b1]&255^this.getByte(k32,1),b2=G.P[G.P_24][b2]&255^this.getByte(k32,2),x=G.P[G.P_34][x]&255^this.getByte(k32,3)):void 0,0===m||3===m?(b0=G.P[G.P_03][b0]&255^this.getByte(k2,0),b1=G.P[G.P_13][b1]&255^this.getByte(k2,1),b2=G.P[G.P_23][b2]&255^this.getByte(k2,2),x=G.P[G.P_33][x]&255^this.getByte(k2,3)):void 0,this.gMDS0[G.P[G.P_01][G.P[G.P_02][b0]&255^this.getByte(k1,0)]&255^this.getByte(k0,0)]^this.gMDS1[G.P[G.P_11][G.P[G.P_12][b1]&255^this.getByte(k1,1)]&255^
this.getByte(k0,1)]^this.gMDS2[G.P[G.P_21][G.P[G.P_22][b2]&255^this.getByte(k1,2)]&255^this.getByte(k0,2)]^this.gMDS3[G.P[G.P_31][G.P[G.P_32][x]&255^this.getByte(k1,3)]&255^this.getByte(k0,3)])};TwoFish.prototype.Fe32_0=function(x){return this.gSBox[2*(x&255)]^this.gSBox[1+2*(x>>>8&255)]^this.gSBox[512+2*(x>>>16&255)]^this.gSBox[513+2*(x>>>24&255)]};TwoFish.prototype.Fe32_3=function(x){return this.gSBox[2*(x>>>24&255)]^this.gSBox[1+2*(x&255)]^this.gSBox[512+2*(x>>>8&255)]^this.gSBox[513+2*(x>>>16&
255)]};TwoFish.prototype._doReset=function(){var i,k3,_l;var k0=[];var k1=[];var b0=[];var b1=[];var B=[];var b3=[];this.k64Cnt=this._key.words.length/2;if(1>this.k64Cnt)throw"Key size less than 64 bits";if(4<this.k64Cnt)throw"Key size larger than 256 bits";for(i=k3=0;256>k3;i=++k3){var A=G.P[0][i]&255;b1[0]=A;B[0]=this.Mx_X(A)&255;b3[0]=this.Mx_Y(A)&255;A=G.P[1][i]&255;b1[1]=A;B[1]=this.Mx_X(A)&255;b3[1]=this.Mx_Y(A)&255;this.gMDS0[i]=b1[G.P_00]|B[G.P_00]<<8|b3[G.P_00]<<16|b3[G.P_00]<<24;this.gMDS1[i]=
b3[G.P_10]|b3[G.P_10]<<8|B[G.P_10]<<16|b1[G.P_10]<<24;this.gMDS2[i]=B[G.P_20]|b3[G.P_20]<<8|b1[G.P_20]<<16|b3[G.P_20]<<24;this.gMDS3[i]=B[G.P_30]|b1[G.P_30]<<8|b3[G.P_30]<<16|B[G.P_30]<<24}i=b1=0;for(B=this.k64Cnt;0<=B?b1<B:b1>B;i=0<=B?++b1:--b1)A=2*i,k0[i]=this.switchEndianness(this._key.words[A]),k1[i]=this.switchEndianness(this._key.words[A+1]),b0[this.k64Cnt-1-i]=this.RS_MDS_Encode(k0[i],k1[i]);for(i=b1=0;20>b1;i=++b1)B=i*G.SK_STEP,A=this.F32(B,k0),B=this.F32(B+G.SK_BUMP,k1),B=B<<8|B>>>24,A+=
B,this.gSubKeys[2*i]=A,A+=B,this.gSubKeys[2*i+1]=A<<G.SK_ROTL|A>>>32-G.SK_ROTL;k0=b0[0];k1=b0[1];A=b0[2];k3=b0[3];this.gSBox=[];var _results=[];for(i=_l=0;256>_l;i=++_l){b0=b1=B=b3=i;var m=this.k64Cnt&3;if(1===m)this.gSBox[2*i]=this.gMDS0[G.P[G.P_01][b0]&255^this.getByte(k0,0)],this.gSBox[2*i+1]=this.gMDS1[G.P[G.P_11][b1]&255^this.getByte(k0,1)],this.gSBox[2*i+512]=this.gMDS2[G.P[G.P_21][B]&255^this.getByte(k0,2)],_results.push(this.gSBox[2*i+513]=this.gMDS3[G.P[G.P_31][b3]&255^this.getByte(k0,3)]);
else{0===m&&(b0=G.P[G.P_04][b0]&255^this.getByte(k3,0),b1=G.P[G.P_14][b1]&255^this.getByte(k3,1),B=G.P[G.P_24][B]&255^this.getByte(k3,2),b3=G.P[G.P_34][b3]&255^this.getByte(k3,3));if(0===m||3===m)b0=G.P[G.P_03][b0]&255^this.getByte(A,0),b1=G.P[G.P_13][b1]&255^this.getByte(A,1),B=G.P[G.P_23][B]&255^this.getByte(A,2),b3=G.P[G.P_33][b3]&255^this.getByte(A,3);this.gSBox[2*i]=this.gMDS0[G.P[G.P_01][G.P[G.P_02][b0]&255^this.getByte(k1,0)]&255^this.getByte(k0,0)];this.gSBox[2*i+1]=this.gMDS1[G.P[G.P_11][G.P[G.P_12][b1]&
255^this.getByte(k1,1)]&255^this.getByte(k0,1)];this.gSBox[2*i+512]=this.gMDS2[G.P[G.P_21][G.P[G.P_22][B]&255^this.getByte(k1,2)]&255^this.getByte(k0,2)];_results.push(this.gSBox[2*i+513]=this.gMDS3[G.P[G.P_31][G.P[G.P_32][b3]&255^this.getByte(k1,3)]&255^this.getByte(k0,3)])}}return _results};TwoFish.prototype.scrub=function(){scrub_vec(this.gSubKeys);scrub_vec(this.gSBox);return this._key.scrub()};TwoFish.prototype.decryptBlock=function(M,offset){var _i;null==offset&&(offset=0);var x2=this.switchEndianness(M[offset])^
this.gSubKeys[4];var x3=this.switchEndianness(M[offset+1])^this.gSubKeys[5];var x0=this.switchEndianness(M[offset+2])^this.gSubKeys[6];var x1=this.switchEndianness(M[offset+3])^this.gSubKeys[7];var k=39;for(_i=0;16>_i;_i+=2){var t0=this.Fe32_0(x2);var t1=this.Fe32_3(x3);x1^=t0+2*t1+this.gSubKeys[k--];x0=(x0<<1|x0>>>31)^t0+t1+this.gSubKeys[k--];x1=x1>>>1|x1<<31;t0=this.Fe32_0(x0);t1=this.Fe32_3(x1);x3^=t0+2*t1+this.gSubKeys[k--];x2=(x2<<1|x2>>>31)^t0+t1+this.gSubKeys[k--];x3=x3>>>1|x3<<31}M[offset]=
this.switchEndianness(x0^this.gSubKeys[0]);M[offset+1]=this.switchEndianness(x1^this.gSubKeys[1]);M[offset+2]=this.switchEndianness(x2^this.gSubKeys[2]);return M[offset+3]=this.switchEndianness(x3^this.gSubKeys[3])};TwoFish.prototype.encryptBlock=function(M,offset){var _i;null==offset&&(offset=0);var x0=this.switchEndianness(M[offset])^this.gSubKeys[0];var x1=this.switchEndianness(M[offset+1])^this.gSubKeys[1];var x2=this.switchEndianness(M[offset+2])^this.gSubKeys[2];var x3=this.switchEndianness(M[offset+
3])^this.gSubKeys[3];var k=8;for(_i=0;16>_i;_i+=2){var t0=this.Fe32_0(x0);var t1=this.Fe32_3(x1);x2^=t0+t1+this.gSubKeys[k++];x2=x2>>>1|x2<<31;x3=(x3<<1|x3>>>31)^t0+2*t1+this.gSubKeys[k++];t0=this.Fe32_0(x2);t1=this.Fe32_3(x3);x0^=t0+t1+this.gSubKeys[k++];x0=x0>>>1|x0<<31;x1=(x1<<1|x1>>>31)^t0+2*t1+this.gSubKeys[k++]}M[offset]=this.switchEndianness(x2^this.gSubKeys[4]);M[offset+1]=this.switchEndianness(x3^this.gSubKeys[5]);M[offset+2]=this.switchEndianness(x0^this.gSubKeys[6]);return M[offset+3]=
this.switchEndianness(x1^this.gSubKeys[7])};return TwoFish}(BlockCipher)}).call(this)}
//# sourceMappingURL=module$node_modules$triplesec$lib$twofish.js.map
