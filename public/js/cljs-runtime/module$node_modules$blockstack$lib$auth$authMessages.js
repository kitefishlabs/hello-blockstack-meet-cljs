shadow$provide.module$node_modules$blockstack$lib$auth$authMessages=function(global,process,require,module,exports,shadow$shims){function encryptPrivateKey(publicKey,privateKey){publicKey=(0,_encryption.encryptECIES)(publicKey,privateKey);publicKey=JSON.stringify(publicKey);return(new shadow$shims.Buffer(publicKey)).toString("hex")}Object.defineProperty(exports,"__esModule",{value:!0});exports.makeAuthRequest=function(){var transitPrivateKey=0<arguments.length&&void 0!==arguments[0]?arguments[0]:
(0,_index.generateAndStoreTransitKey)(),redirectURI=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.location.origin+"/",manifestURI=2<arguments.length&&void 0!==arguments[2]?arguments[2]:window.location.origin+"/manifest.json",scopes=3<arguments.length&&void 0!==arguments[3]?arguments[3]:_authConstants.DEFAULT_SCOPE,appDomain=4<arguments.length&&void 0!==arguments[4]?arguments[4]:window.location.origin,expiresAt=5<arguments.length&&void 0!==arguments[5]?arguments[5]:(0,_index.nextHour)().getTime();
redirectURI=Object.assign({},6<arguments.length&&void 0!==arguments[6]?arguments[6]:{},{jti:(0,_index.makeUUID4)(),iat:Math.floor((new Date).getTime()/1E3),exp:Math.floor(expiresAt/1E3),iss:null,public_keys:[],domain_name:appDomain,manifest_uri:manifestURI,redirect_uri:redirectURI,version:VERSION,do_not_include_profile:!0,supports_hub_url:!0,scopes:scopes});_logger.Logger.info("blockstack.js: generating v"+VERSION+" auth request");manifestURI=_jsontokens.SECP256K1Client.derivePublicKey(transitPrivateKey);
redirectURI.public_keys=[manifestURI];manifestURI=(0,_index.publicKeyToAddress)(manifestURI);redirectURI.iss=(0,_index.makeDIDFromAddress)(manifestURI);return(new _jsontokens.TokenSigner("ES256k",transitPrivateKey)).sign(redirectURI)};exports.encryptPrivateKey=encryptPrivateKey;exports.decryptPrivateKey=function(privateKey,hexedEncrypted){hexedEncrypted=(new shadow$shims.Buffer(hexedEncrypted,"hex")).toString();hexedEncrypted=JSON.parse(hexedEncrypted);privateKey=(0,_encryption.decryptECIES)(privateKey,
hexedEncrypted);if("string"!==typeof privateKey)throw Error("Unable to correctly decrypt private key");return privateKey};exports.makeAuthResponse=function(privateKey){var profile=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},username=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,metadata=arguments[3],coreToken=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,appPrivateKey=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,expiresAt=6<arguments.length&&
void 0!==arguments[6]?arguments[6]:(0,_index.nextMonth)().getTime(),transitPublicKey=7<arguments.length&&void 0!==arguments[7]?arguments[7]:null,hubUrl=8<arguments.length&&void 0!==arguments[8]?arguments[8]:null,blockstackAPIUrl=9<arguments.length&&void 0!==arguments[9]?arguments[9]:null,associationToken=10<arguments.length&&void 0!==arguments[10]?arguments[10]:null,publicKey=_jsontokens.SECP256K1Client.derivePublicKey(privateKey),address=(0,_index.publicKeyToAddress)(publicKey),privateKeyPayload=
appPrivateKey,coreTokenPayload=coreToken,additionalProperties={};void 0!==appPrivateKey&&null!==appPrivateKey?(_logger.Logger.info("blockstack.js: generating v"+VERSION+" auth response"),void 0!==transitPublicKey&&null!==transitPublicKey&&(privateKeyPayload=encryptPrivateKey(transitPublicKey,appPrivateKey),void 0!==coreToken&&null!==coreToken&&(coreTokenPayload=encryptPrivateKey(transitPublicKey,coreToken))),additionalProperties={email:metadata.email?metadata.email:null,profile_url:metadata.profileUrl?
metadata.profileUrl:null,hubUrl:hubUrl,blockstackAPIUrl:blockstackAPIUrl,associationToken:associationToken,version:VERSION}):_logger.Logger.info("blockstack.js: generating legacy auth response");profile=Object.assign({},{jti:(0,_index.makeUUID4)(),iat:Math.floor((new Date).getTime()/1E3),exp:Math.floor(expiresAt/1E3),iss:(0,_index.makeDIDFromAddress)(address),private_key:privateKeyPayload,public_keys:[publicKey],profile:profile,username:username,core_token:coreTokenPayload},additionalProperties);
return(new _jsontokens.TokenSigner("ES256k",privateKey)).sign(profile)};require("module$node_modules$cross_fetch$dist$browser_polyfill");var _jsontokens=require("module$node_modules$jsontokens$lib$index"),_index=require("module$node_modules$blockstack$lib$index"),_authConstants=require("module$node_modules$blockstack$lib$auth$authConstants"),_encryption=require("module$node_modules$blockstack$lib$encryption"),_logger=require("module$node_modules$blockstack$lib$logger"),VERSION="1.3.1"}
//# sourceMappingURL=module$node_modules$blockstack$lib$auth$authMessages.js.map
