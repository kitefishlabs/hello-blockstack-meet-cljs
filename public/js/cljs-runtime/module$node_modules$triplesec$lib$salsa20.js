shadow$provide.module$node_modules$triplesec$lib$salsa20=function(global,process,require,module,exports,shadow$shims){(function(){var Cipher$jscomp$0,Salsa20WordStream,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};var iced=require("module$node_modules$iced_runtime$lib$main");
var Salsa20Core=require("module$node_modules$triplesec$lib$wordarray");var endian_reverse=Salsa20Core.endian_reverse;var WordArray=Salsa20Core.WordArray;var Counter=require("module$node_modules$triplesec$lib$ctr").Counter;var fixup_uint32=require("module$node_modules$triplesec$lib$util").fixup_uint32;var StreamCipher=require("module$node_modules$triplesec$lib$algbase").StreamCipher;var util=require("module$node_modules$triplesec$lib$util");var asum=function(out,v){var _i,_len;var i=_i=0;for(_len=
v.length;_i<_len;i=++_i){var e=v[i];out[i]+=e}return!1};var Salsa20InnerCore=function(){function Salsa20InnerCore(rounds){this.rounds=rounds}Salsa20InnerCore.prototype._core=function(v){var _ref1;var x0=v[0];var x1=v[1];var x2=v[2];var x3=v[3];var x4=v[4];var x5=v[5];var x6=v[6];var x7=v[7];var x8=v[8];var x9=v[9];var x10=v[10];var x11=v[11];var x12=v[12];var x13=v[13];var x14=v[14];var x15=v[15];var _i=0;for(_ref1=this.rounds;_i<_ref1;_i+=2)v=x0+x12|0,x4^=v<<7|v>>>25,v=x4+x0|0,x8^=v<<9|v>>>23,v=
x8+x4|0,x12^=v<<13|v>>>19,v=x12+x8|0,x0^=v<<18|v>>>14,v=x5+x1|0,x9^=v<<7|v>>>25,v=x9+x5|0,x13^=v<<9|v>>>23,v=x13+x9|0,x1^=v<<13|v>>>19,v=x1+x13|0,x5^=v<<18|v>>>14,v=x10+x6|0,x14^=v<<7|v>>>25,v=x14+x10|0,x2^=v<<9|v>>>23,v=x2+x14|0,x6^=v<<13|v>>>19,v=x6+x2|0,x10^=v<<18|v>>>14,v=x15+x11|0,x3^=v<<7|v>>>25,v=x3+x15|0,x7^=v<<9|v>>>23,v=x7+x3|0,x11^=v<<13|v>>>19,v=x11+x7|0,x15^=v<<18|v>>>14,v=x0+x3|0,x1^=v<<7|v>>>25,v=x1+x0|0,x2^=v<<9|v>>>23,v=x2+x1|0,x3^=v<<13|v>>>19,v=x3+x2|0,x0^=v<<18|v>>>14,v=x5+x4|
0,x6^=v<<7|v>>>25,v=x6+x5|0,x7^=v<<9|v>>>23,v=x7+x6|0,x4^=v<<13|v>>>19,v=x4+x7|0,x5^=v<<18|v>>>14,v=x10+x9|0,x11^=v<<7|v>>>25,v=x11+x10|0,x8^=v<<9|v>>>23,v=x8+x11|0,x9^=v<<13|v>>>19,v=x9+x8|0,x10^=v<<18|v>>>14,v=x15+x14|0,x12^=v<<7|v>>>25,v=x12+x15|0,x13^=v<<9|v>>>23,v=x13+x12|0,x14^=v<<13|v>>>19,v=x14+x13|0,x15^=v<<18|v>>>14;return[x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15]};return Salsa20InnerCore}();Salsa20Core=function(_super){function Salsa20Core(key,nonce){var _ref1;Salsa20Core.__super__.constructor.call(this,
20);this.key=key.clone().endian_reverse();this.nonce=nonce.clone().endian_reverse();if((16!==this.key.sigBytes||8!==this.nonce.sigBytes)&&(32!==this.key.sigBytes||8!==(_ref1=this.nonce.sigBytes)&&24!==_ref1))throw Error("Bad key/nonce lengths");24===this.nonce.sigBytes&&this.xsalsa_setup();this.input=this.key_iv_setup(this.nonce,this.key);this._reset()}__extends(Salsa20Core,_super);Salsa20Core.prototype.sigma=WordArray.from_buffer_le(new shadow$shims.Buffer("expand 32-byte k"));Salsa20Core.prototype.tau=
WordArray.from_buffer_le(new shadow$shims.Buffer("expand 16-byte k"));Salsa20Core.blockSize=64;Salsa20Core.prototype.blockSize=Salsa20Core.blockSize;Salsa20Core.keySize=32;Salsa20Core.prototype.keySize=Salsa20Core.keySize;Salsa20Core.ivSize=24;Salsa20Core.prototype.ivSize=Salsa20Core.ivSize;Salsa20Core.prototype.scrub=function(){this.key.scrub();this.nonce.scrub();return util.scrub_vec(this.input)};Salsa20Core.prototype.xsalsa_setup=function(){var n0=new WordArray(this.nonce.words.slice(0,4));this.nonce=
new WordArray(this.nonce.words.slice(4));return this.key=this.hsalsa20(n0,this.key)};Salsa20Core.prototype.hsalsa20=function(nonce,key){key=this.key_iv_setup(nonce,key);key[8]=nonce.words[2];key[9]=nonce.words[3];var v=this._core(key);var indexes=[0,5,10,15,6,7,8,9];var _len;var _results=[];var _i=0;for(_len=indexes.length;_i<_len;_i++)nonce=indexes[_i],_results.push(fixup_uint32(v[nonce]));v=_results;util.scrub_vec(key);return new WordArray(v)};Salsa20Core.prototype.key_iv_setup=function(nonce,key){var A,
i,_j;var out=[];for(i=A=0;4>A;i=++A)out[i+1]=key.words[i];i=32===key.sigBytes?[this.sigma,key.words.slice(4)]:[this.tau,key.words];key=i[0];A=i[1];for(i=_j=0;4>_j;i=++_j)out[i+11]=A[i];for(i=A=0;4>A;i=++A)out[5*i]=key.words[i];out[6]=nonce.words[0];out[7]=nonce.words[1];return out};Salsa20Core.prototype.counter_setup=function(){this.input[8]=this.counter.get().words[0];return this.input[9]=this.counter.get().words[1]};Salsa20Core.prototype._reset=function(){return this.counter=new Counter({len:2})};
Salsa20Core.prototype._generateBlock=function(){this.counter_setup();var v=this._core(this.input);asum(v,this.input);this.counter.inc_le();return v};return Salsa20Core}(Salsa20InnerCore);exports.Salsa20WordStream=Salsa20WordStream=function(_super){function Salsa20WordStream(){return Salsa20WordStream.__super__.constructor.apply(this,arguments)}__extends(Salsa20WordStream,_super);Salsa20WordStream.prototype._reset=function(){return Salsa20WordStream.__super__._reset.call(this)};Salsa20WordStream.prototype.getWordArray=
function(nbytes){var i,w,_len;if(null==nbytes||nbytes===this.blockSize)var nblocks=this._generateBlock();else{nblocks=Math.ceil(nbytes/this.blockSize);var _i=[];for(w=0;0<=nblocks?w<nblocks:w>nblocks;0<=nblocks?++w:--w)_i.push(this._generateBlock());nblocks=(i=[]).concat.apply(i,_i)}i=_i=0;for(_len=nblocks.length;_i<_len;i=++_i)w=nblocks[i],nblocks[i]=endian_reverse(w);return new WordArray(nblocks,nbytes)};return Salsa20WordStream}(Salsa20Core);exports.Salsa20=function(_super){function Salsa20(){return Salsa20.__super__.constructor.apply(this,
arguments)}__extends(Salsa20,_super);Salsa20.prototype._reset=function(){Salsa20.__super__._reset.call(this);return this._i=this.blockSize};Salsa20.prototype.getBytes=function(needed){null==needed&&(needed=this.blockSize);var v=[];var bsz=this.blockSize;if(this._i===bsz&&needed===bsz)return this._generateBlockBuffer();for(;0<needed;){this._i===bsz&&(this._generateBlockBuffer(),this._i=0);var n=Math.min(needed,bsz-this._i);v.push(n===bsz?this._buf:this._buf.slice(this._i,this._i+n));this._i+=n;needed-=
n}return shadow$shims.Buffer.concat(v)};Salsa20.prototype._generateBlockBuffer=function(){var _i,_len;this._buf=new shadow$shims.Buffer(this.blockSize);var v=this._generateBlock();var i=_i=0;for(_len=v.length;_i<_len;i=++_i){var e=v[i];this._buf.writeUInt32LE(fixup_uint32(e),4*i)}return this._buf};return Salsa20}(Salsa20Core);exports.Cipher=Cipher$jscomp$0=function(_super){function Cipher(_arg){var key=_arg.key;_arg=_arg.iv;Cipher.__super__.constructor.call(this);this.salsa=new Salsa20WordStream(key,
_arg);this.bsiw=this.salsa.blockSize/4}__extends(Cipher,_super);Cipher.prototype.scrub=function(){return this.salsa.scrub()};Cipher.prototype.get_pad=function(){return this.salsa.getWordArray()};return Cipher}(StreamCipher);exports.encrypt=function(_arg){var key=_arg.key;var cipher=_arg.iv;_arg=_arg.input;cipher=new Cipher$jscomp$0({key:key,iv:cipher});_arg=cipher.encrypt(_arg);cipher.scrub();return _arg};exports.bulk_encrypt=function(_arg,cb){var ret,__iced_deferrals;var ___iced_passed_deferral=
iced.findDeferral(arguments);var key=_arg.key;var iv=_arg.iv;var input=_arg.input;var progress_hook=_arg.progress_hook;var cipher=new Cipher$jscomp$0({key:key,iv:iv});(function(_this){return function(__iced_k){__iced_deferrals=new iced.Deferrals(__iced_k,{parent:___iced_passed_deferral,filename:"/Users/max/src/keybase/triplesec/src/salsa20.iced"});cipher.bulk_encrypt({input:input,progress_hook:progress_hook,what:"salsa20"},__iced_deferrals.defer({assign_fn:function(){return function(JSCompiler_OptimizeArgumentsArray_p6){return ret=
JSCompiler_OptimizeArgumentsArray_p6}}(),lineno:256}));__iced_deferrals._fulfill()}})(this)(function(_this){return function(){cipher.scrub();return cb(ret)}}(this))};exports.Salsa20InnerCore=Salsa20InnerCore;exports.endian_reverse=endian_reverse;exports.asum=asum}).call(this)}
//# sourceMappingURL=module$node_modules$triplesec$lib$salsa20.js.map
